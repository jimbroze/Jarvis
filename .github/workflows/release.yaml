name: Release - Test, Build & Redeploy

on:
  push:
    branches:
      - 'release-*'

# jobs:
#   test:
#     name: Test - Unit & Integration
#     runs-on: self-hosted
#     steps:
#       - uses: actions/checkout@v1
#       - name: Set up JDK 11
#         uses: actions/setup-java@v1
#         with:
#           java-version: 11.0.4
#       - name: Maven Package
#         run: mvn -B clean package -DskipTests
#       - name: Maven Verify
#         run: mvn -B clean verify

  deploy:
    name: Deploy docker containers
    runs-on: self-hosted
#     needs: [test]
    steps:
      - uses: actions/checkout@v2
      - name: Stop Containers
        working-directory: Docker
        run: docker-compose stop
      - name: Build Images
        working-directory: Docker
        run: docker-compose build --pull
      - name: Start Containers
        working-directory: Docker
        run: docker-compose up
